// SPDX-License-Identifier: (GPL-2.0-only OR BSD-3-Clause)
/*
 * Copyright (C) STMicroelectronics 2023 - All Rights Reserved
 */

/dts-v1/;

#include <dt-bindings/clock/stm32mp25-clksrc.h>
#include <dt-bindings/ipcc/stm32mp25-ipcc.h>
#include <dt-bindings/power/stm32mp25-power.h>
#include <dt-bindings/regulator/stm32mp25-regulator.h>
#include <dt-bindings/reset/st,stm32mp25-rcc.h>
#include <dt-bindings/rif/stm32mp25-rif.h>
#include <dt-bindings/rif/stm32mp25-rifsc.h>
#include <dt-bindings/rif/stm32mp2-risaf.h>
#include <dt-bindings/rif/stm32mp25-risab.h>
#include <dt-bindings/tamp/st,stm32mp25-tamp.h>
#include <dt-bindings/gpio/st,stm32mp25-tamp-gpio.h>

#include "stm32mp257.dtsi"
#include "stm32mp25xf.dtsi"
#include "stm32mp257f-ev1-cm33tdcid-ostl-resmem.dtsi"
#include "stm32mp257f-ev1-cm33tdcid-ostl-rcc.dtsi"
#include "stm32mp257f-ev1-cm33tdcid-ostl-scmi.dtsi"
#include "stm32mp257f-ev1-cm33tdcid-ostl-s-rif-snor.dtsi"
#include "stm32mp257f-ev1-cm33tdcid-ostl-s-rif-ca35-snor.dtsi"
#include "stm32mp25-pinctrl.dtsi"
#include "stm32mp25xxai-pinctrl.dtsi"

/ {
	model = "STMicroelectronics STM32MP257F-EV1 CM33TDCID OSTL A35_SNOR Evaluation Board";
	compatible = "st,stm32mp257f-ev1-cm33tdcid-ostl-snor", "st,stm32mp257f-ev1", "st,stm32mp257";
	aliases {
		serial0 = &uart5;
	};

	chosen {
		stdout-device = &uart5;
		tfm,entropy = &rng;
		tfm,watchdog = &iwdg3;
	};

	memory@80000000 {
		device_type = "memory";
		reg = <0x80000000 0x80000000>;
	};
};

&iac {
	status = "okay";
};

&serc {
	status = "okay";
};

&uart5 {
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&uart5_pins_a>;
	pinctrl-1 = <&uart5_sleep_pins_a>;
	clocks = <&rcc CK_KER_UART5>;
	current-speed = <115200>;
	status = "okay";
};

&systick {
	clocks = <&rcc CK_ICN_HS_MCU>;
	clock-frequency = <1000000>; /* tick at 1us */
	status = "okay";
};

&tim2 {
	status = "okay";
};

&i2c7 {
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&i2c7_pins_a>;
	pinctrl-1 = <&i2c7_sleep_pins_a>;
	i2c-scl-rising-time-ns = <185>;
	i2c-scl-falling-time-ns = <20>;
	clock-frequency = <400000>;
	status = "okay";

	#address-cells = <1>;
	#size-cells = <0>;

	stpmic25: pmic@33 {
		compatible = "st,stpmic2";
		reg = <0x33>;
		status = "okay";

		regulators {
			compatible = "st,stpmic2-regulators";

			vddcpu: buck1 {
				regulator-name = "vddcpu";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <910000>;
				regulator-always-on;
				st,pwrctrl-sel = <2>;
				st,pwrctrl-enable;

				default {
					regulator-off-in-suspend;
				};
				lplv {
					regulator-off-in-suspend;
				};
				standby {
					regulator-off-in-suspend;
				};
				off {
					regulator-off-in-suspend;
				};
			};
			vddcore: buck2 {
				regulator-name = "vddcore";
				regulator-min-microvolt = <820000>;
				regulator-max-microvolt = <820000>;
				regulator-always-on;
				st,pwrctrl-sel = <1>;
				st,pwrctrl-enable;

				default {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <820000>;
				};
				lplv {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <670000>;
				};
				standby {
					regulator-off-in-suspend;
				};
				off {
					regulator-off-in-suspend;
				};
			};
			vddgpu_pmic: buck3 {
				regulator-name = "vddgpu_pmic";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <900000>;
				regulator-always-on;
				regulator-over-current-protection;

				standby {
					regulator-off-in-suspend;
				};
				off {
					regulator-off-in-suspend;
				};
			};
			vddio_pmic: buck4 {
				regulator-name = "vddio_pmic";
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				regulator-always-on;
				st,mask-reset;
				st,pwrctrl-sel = <1>;
				st,pwrctrl-enable;

				default {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <3300000>;
				};
				lplv {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <3300000>;
				};
				standby {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <3300000>;
				};
				off {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <3300000>;
				};
			};
			v1v8: buck5 {
				regulator-name = "v1v8";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;
				regulator-always-on;
				st,pwrctrl-sel = <1>;
				st,pwrctrl-enable;

				default {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <1800000>;
				};
				lplv {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <1800000>;
				};
				standby {
					regulator-off-in-suspend;
				};
				off {
					regulator-off-in-suspend;
				};
			};
			vdd_ddr: buck6 {
				regulator-name = "vdd_ddr";
				regulator-min-microvolt = <1200000>;
				regulator-max-microvolt = <1200000>;
				regulator-always-on;
				regulator-pull-down;
				st,pwrctrl-sel = <1>;
				st,pwrctrl-enable;

				default {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <1200000>;
				};
				lplv {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <1200000>;
				};
				standby {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <1200000>;
				};
				off {
					regulator-off-in-suspend;
				};
			};
			v3v3: buck7 {
				regulator-name = "v3v3";
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				regulator-always-on;
				regulator-over-current-protection;
				st,pwrctrl-sel = <1>;
				st,pwrctrl-enable;

				default {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <3300000>;
				};
				lplv {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <3300000>;
				};
				standby {
					regulator-off-in-suspend;
				};
				off {
					regulator-off-in-suspend;
				};
			};
			vdda1v8_aon: ldo1 {
				regulator-name = "vdda1v8_aon";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;
				regulator-always-on;
				st,alternate-input-source;
				st,mask-reset;
			};
			vdd_emmc: ldo2 {
				regulator-name = "vdd_emmc";
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				regulator-over-current-protection;
				st,pwrctrl-sel = <3>;
				st,pwrctrl-reset;
			};
			vtt_ddr: ldo3 {
				regulator-name = "vtt_ddr";
				st,regulator-sink-source;
				regulator-always-on;
				st,pwrctrl-sel = <1>;
				st,pwrctrl-enable;

				default {
					regulator-off-in-suspend;
				};
				lplv {
					regulator-off-in-suspend;
				};
				standby {
					regulator-off-in-suspend;
				};
				off {
					regulator-off-in-suspend;
				};
			};
			vdd3v3_usb: ldo4 {
				regulator-name = "vdd3v3_usb";
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				regulator-always-on;
				regulator-over-current-protection;

				standby {
					regulator-off-in-suspend;
				};
				off {
					regulator-off-in-suspend;
				};
			};
			vpp_ddr: ldo5 {
				regulator-name = "vpp_ddr";
				regulator-min-microvolt = <2500000>;
				regulator-max-microvolt = <2500000>;
				regulator-always-on;
				st,pwrctrl-sel = <1>;
				st,pwrctrl-enable;

				default {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <2500000>;
				};
				lplv {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <2500000>;
				};
				standby {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <2500000>;
				};
				off {
					regulator-off-in-suspend;
				};
			};
			vdd_sdcard: ldo7 {
				regulator-name = "vdd_sdcard";
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				regulator-over-current-protection;
				st,regulator-bypass-microvolt = <3300000>;
				st,pwrctrl-sel = <3>;
				st,pwrctrl-reset;
			};
			vddio_sdcard: ldo8 {
				regulator-name = "vddio_sdcard";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				regulator-over-current-protection;
				st,regulator-bypass-microvolt = <3300000>;
				st,pwrctrl-sel = <3>;
				st,pwrctrl-reset;
			};
			vref_ddr: refddr {
				regulator-name = "vref_ddr";
				regulator-always-on;
				st,pwrctrl-sel = <1>;
				st,pwrctrl-enable;

				default {
					regulator-on-in-suspend;
				};
				lplv {
					regulator-on-in-suspend;
				};
				standby {
					regulator-on-in-suspend;
				};
				off {
					regulator-off-in-suspend;
				};
			};
		};
	};
};

&ipcc1 {
	status = "okay";
};

&psa_mbox {
	status = "okay";
	mboxes = <&ipcc1 IPCC_CHANNEL(14)>;
	mbox-names = "s";
	memory-region = <&psa_buffer_cid1_s>;
};

&ommanager {
	status = "okay";
};

&bsec {
	memory-region = <&bsec_mirror>;
	status = "okay";
};

&pwr {
	status = "okay";

	vdd33ucpd: vdd33ucpd {
		status = "okay";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		vin-supply = <&vdd3v3_usb>;
		regulator-always-on;
	};

	vdda18adc: vdda18adc {
		status = "okay";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		vin-supply = <&v1v8>;
		regulator-always-on;
	};

	vddgpu: vddgpu {
		status = "okay";
		vin-supply = <&vddgpu_pmic>;
	};

	vddio1: vddio1 {
		status = "okay";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <3300000>;
		vin-supply = <&vddio_sdcard>;
	};

	vddio2: vddio2 {
		status = "okay";
		vin-supply = <&v1v8>;
		regulator-always-on;
	};

	vddio3: vddio3 {
		status = "okay";
		vin-supply = <&vddio_pmic>;
		regulator-always-on;
	};

	vddio4: vddio4 {
		status = "okay";
		vin-supply = <&vddio_pmic>;
		regulator-always-on;
	};

	vddio: vddio {
		status = "okay";
		vin-supply = <&vddio_pmic>;
	};
};

&ramcfg {
	status = "okay";
};

&scmi_ca35 {
	status = "okay";
	memory-region = <&scmi_cid1_ns>;
	mboxes = <&ipcc1 IPCC_CHANNEL(16)>;
	regu-list = <&scmi_vddcore>, <&scmi_v1v8>, <&scmi_v3v3> , <&scmi_vdd_emmc>,
		     <&scmi_vdd3v3_usb>, <&scmi_vdd_sdcard>, <&scmi_vddio1>,
         <&scmi_vddio2>, <&scmi_vddio3>,  <&scmi_vddio4>,
         <&scmi_vdd33ucpd>, <&scmi_vdda18adc>;
	regu-id-max = <STMP25_VOLTD_SCMI_MAX>;

	rst-list = <&scmi_rst_fmc>, <&scmi_rst_ospi1>, <&scmi_rst_ospi1dll>;
	rst-id-max = <STM32MP25_RST_SCMI_MAX>;
	clk-list = <&scmi_clk_icn_sdmmc>, <&scmi_clk_icn_ddr>,
         <&scmi_clk_icn_display>, <&scmi_clk_icn_hsl>,
         <&scmi_clk_icn_nic>, <&scmi_clk_icn_vid>,
         <&scmi_clk_flexgen_07>, <&scmi_clk_flexgen_08>,
	 <&scmi_clk_flexgen_09>, <&scmi_clk_flexgen_10>,
         <&scmi_clk_flexgen_11>, <&scmi_clk_flexgen_12>,
         <&scmi_clk_flexgen_13>, <&scmi_clk_flexgen_14>,
         <&scmi_clk_flexgen_15>, <&scmi_clk_flexgen_16>,
         <&scmi_clk_flexgen_17>, <&scmi_clk_flexgen_18>,
         <&scmi_clk_flexgen_19>, <&scmi_clk_flexgen_20>,
         <&scmi_clk_flexgen_21>, <&scmi_clk_flexgen_22>,
         <&scmi_clk_flexgen_23>, <&scmi_clk_flexgen_24>,
         <&scmi_clk_flexgen_25>, <&scmi_clk_flexgen_26>,
         <&scmi_clk_flexgen_27>, <&scmi_clk_flexgen_28>,
         <&scmi_clk_flexgen_29>, <&scmi_clk_flexgen_30>,
         <&scmi_clk_flexgen_31>, <&scmi_clk_flexgen_32>,
         <&scmi_clk_flexgen_33>, <&scmi_clk_flexgen_34>,
         <&scmi_clk_flexgen_35>, <&scmi_clk_flexgen_36>,
         <&scmi_clk_flexgen_37>, <&scmi_clk_flexgen_38>,
         <&scmi_clk_flexgen_39>, <&scmi_clk_flexgen_40>,
         <&scmi_clk_flexgen_41>, <&scmi_clk_flexgen_42>,
         <&scmi_clk_flexgen_43>, <&scmi_clk_flexgen_44>,
         <&scmi_clk_flexgen_45>, <&scmi_clk_flexgen_46>,
         <&scmi_clk_flexgen_47>, <&scmi_clk_flexgen_48>,
         <&scmi_clk_flexgen_49>, <&scmi_clk_flexgen_50>,
         <&scmi_clk_flexgen_51>, <&scmi_clk_flexgen_52>,
         <&scmi_clk_flexgen_53>, <&scmi_clk_flexgen_54>,
         <&scmi_clk_flexgen_55>, <&scmi_clk_flexgen_56>,
         <&scmi_clk_flexgen_57>, <&scmi_clk_flexgen_58>,
         <&scmi_clk_flexgen_59>, <&scmi_clk_flexgen_60>,
         <&scmi_clk_flexgen_61>, <&scmi_clk_flexgen_62>,
         <&scmi_clk_flexgen_63>,

         <&scmi_clk_gpioa>, <&scmi_clk_gpiob>,
         <&scmi_clk_gpioc>, <&scmi_clk_gpiod>,
         <&scmi_clk_gpioe>, <&scmi_clk_gpiof>,
         <&scmi_clk_gpiog>, <&scmi_clk_gpioh>,
         <&scmi_clk_gpioi>, <&scmi_clk_gpioj>,
         <&scmi_clk_gpiok>, <&scmi_clk_gpioz>,

         <&scmi_clk_icn_ls_mcu>, <&scmi_clk_hse>,
         <&scmi_clk_lse>, <&scmi_clk_hsi>, <&scmi_clk_lsi>,
         <&scmi_clk_msi>, <&scmi_clk_rtcck>,
         <&scmi_clk_icn_apb1>, <&scmi_clk_icn_apb2>,
         <&scmi_clk_icn_apb3>, <&scmi_clk_icn_apb4>,
         <&scmi_clk_icn_apbdbg>, <&scmi_clk_timg1>,
         <&scmi_clk_timg2>, <&scmi_clk_bkpsram>,
         <&scmi_clk_bsec>, <&scmi_clk_bus_etr>,
         <&scmi_clk_fmc>, <&scmi_clk_hpdma1>,
         <&scmi_clk_hpdma2>, <&scmi_clk_hpdma3>, <&scmi_clk_hsem>,
         <&scmi_clk_ipcc1>, <&scmi_clk_ipcc2>,
         <&scmi_clk_lpdma>, <&scmi_clk_retram>,
         <&scmi_clk_rtc>, <&scmi_clk_sram1>,
         <&scmi_clk_sram2>, <&scmi_clk_syscpu1>,
         <&scmi_clk_hse_div2>,
         <&scmi_clk_pll2>, <&scmi_clk_pll3>,
         <&scmi_clk_lpsram1>, <&scmi_clk_lpsram2>,
         <&scmi_clk_lpsram3>, <&scmi_clk_vderam>,
         <&scmi_clk_sysram>, <&scmi_clk_ospi1>,
         <&scmi_clk_ospi2>, <&scmi_clk_tpiu>,
         <&scmi_clk_sysdbg>, <&scmi_clk_sysatb>,
         <&scmi_clk_tsdbg>, <&scmi_clk_ker_etr>,
         <&scmi_clk_bus_stm>, <&scmi_clk_hsi_ker_ck>,
         <&scmi_clk_hse_ker_ck>, <&scmi_clk_msi_ker_ck>,
         <&scmi_clk_gpioz_am>, <&scmi_clk_ipcc2_am>,
         <&scmi_clk_lpdma_am>, <&scmi_clk_rtc_am>,
         <&scmi_clk_ker_stm>, <&scmi_clk_bus_pcie>;

	clk-id-max = <STM32MP25_CK_SCMI_MAX>;

	pd-list = <&scmi_pd_gpu>;
	pd-id-max = <STM32MP25_PD_SCMI_MAX>;
};

&scmi_m33 {
	status = "okay";
	regu-list = <&scmi_vddcore>, <&scmi_v1v8>, <&scmi_v3v3>,
		      <&scmi_vdd3v3_usb>;
	regu-id-max = <STMP25_VOLTD_SCMI_MAX>;

	rst-list = <&scmi_rst_fmc>;
	rst-id-max = <STM32MP25_RST_SCMI_MAX>;
	clk-list = <&scmi_clk_icn_display>, <&scmi_clk_gpiob>, <&scmi_clk_flexgen_27>,
		      <&scmi_clk_flexgen_07>, <&scmi_clk_flexgen_08>,
		      <&scmi_clk_flexgen_09>, <&scmi_clk_flexgen_10>;
	clk-id-max = <STM32MP25_CK_SCMI_MAX>;

};

&scmi_bl31 {
	status = "okay";
	memory-region = <&scmi_cid1_s>;
	mboxes = <&ipcc1 IPCC_CHANNEL(15)>;
	regu-list = <&scmi_vddcpu>;
	regu-id-max = <(VOLTD_SCMI_STPMIC2_BUCK1+1)>;
};

&rtc {
	status = "okay";
};

&hpdma1 {
	status = "okay";
};

&hpdma2 {
	status = "okay";
};

&hpdma3 {
	status = "okay";
};

&exti1 {
	status = "okay";
};

&exti2 {
	status = "okay";
};

&tamp {
	status = "okay";
	st,tamp-passive-precharge = <2>;
	st,tamp-passive-nb-sample = <4>;
	st,tamp-passive-sample-clk-div = <16384>;
	st,tamp-active-filter = <1>;
	st,tamp-active-clk-div = <2048>;

	tamp-button {
		compatible = "st,stm32-tamp-external";
		tamper-gpios = <&tamp STM32_TAMP_GPIO_IN(1, PI8) 0>;
		st,tamp-mode = <TAMPER_CONFIRMED_MODE>;
		st,tamp-id = <1>;
		status = "okay";
	};
};

&hconf1_otp {
	shadow-provisionning = <0x00018db6>;
};

&nvram {
	status = "okay";

	nvmem-layout {
		#address-cells = <1>;
		#size-cells = <1>;
		rsc_tbl_addr_m33td: tamp-bkp@1e4 {
			#nvmem-cell-cells = <0>;
			reg = <0x1e4 0x4>;
		};
		rsc_tbl_size_m33td: tamp-bkp@1e8 {
			#nvmem-cell-cells = <0>;
			reg = <0x1e8 0x4>;
		};
	};
};

&a35_rproc {
	nvmem-cells = <&rsc_tbl_addr_m33td>, <&rsc_tbl_size_m33td>;
	nvmem-cell-names = "rsc_tab_addr","rsc_tab_size";

	status = "okay";
};

&cpu0 {
	enable-method = "remoteproc";
	remoteprocs = <&a35_rproc>;
};

&risab3 {
	status = "okay";
};

&risab4 {
	status = "okay";
};

&risab5 {
	status = "okay";
};

&risaf1 {
	status = "okay";
};

&risaf2 {
	status = "okay";
};

&risaf4 {
	status = "okay";
};

&risaf5 {
	status = "okay";
};

&rifsc {
	status = "okay";
};

&rng {
	status = "okay";
};

&iwdg3 {
	status = "okay";
	timeout-sec = <120>;
};

&saes {
	status = "okay";
};

&sau {
	memory-region = <&cm33_cube_fw>, <&cm33_cube_data>, <&scmi_cid1_ns>, <&ipc_shmem>, <&ltdc_m33_layer>;
};

&syscfg {
	st,reg-init = <STM32MP25_SYSCFG_ICNE2EBWRCR 0x00000051>,
		      <STM32MP25_SYSCFG_ICNGPUBWLCR 0x00004009>,
		      <STM32MP25_SYSCFG_ICNQPCR2 0x2149865A>,
		      <STM32MP25_SYSCFG_ICNCPU1BWLCR 0x00005002>;
};
